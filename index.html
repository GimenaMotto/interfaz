<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Oposiciones Arquitectos Madrid Facturación</title>
  <style>
    /* Estilos para simular la consola */
    .console {
      background-color: #1E1E1E;
      color: #FFFFFF;
      font-family: monospace;
      padding: 10px;
      border: 1px solid #CCCCCC;
      width: 80%;
      height: 200px;
      overflow-y: auto;
      margin-top: 20px; /* Agrega espacio arriba de la consola */
    }

    /* Estilos para el contenedor principal */
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Estilos para los elementos del formulario */
    label {
      margin-top: 10px; /* Agrega espacio arriba de cada label */
    }

    input[type="number"],
    input[type="file"],
    button {
      margin-top: 5px; /* Agrega espacio arriba de los input y el botón */
    }

    button {
      padding: 8px 20px; /* Aumenta el tamaño del botón */
    }

    /* Estilos para colocar elementos uno al lado del otro */
    .flex-container {
      display: flex;
      align-items: center;
    }

    .flex-item {
      margin-right: 10px; /* Agrega espacio entre elementos */
    }

    .margin-button {
      margin-top: 30px;
  
    
    }
  </style>
</head>
<body>
  <div id="container">
    <h3>Datos alumnos/as y facturas</h3>
    <div class="flex-container" style="justify-content: center;">
      <div class="flex-item">
        <label for="lastNumberInput" style="margin-left: 40px; margin-top: 20px;" >Número de factura inicial </label>
        <input type="number" id="lastNumberInput" placeholder="Ingrese el número de factura" style="margin-left: 40px; margin-top: 10px;">
      </div>

      <label for="dateInput" style="margin-top: 20px;">Fecha de factura/s:</label>
<input type="text" id="dateInput" style="margin-top: 10px;">

      <div class="flex-item">
        <label for="jsonFileInput" style="margin-top: 20px;">Seleccione un archivo JSON:</label>
        <input type="file" id="jsonFileInput" style="margin-top: 10px;">
      </div>
    </div>
      <div class="flex-item" style="text-align: left;">
        <button onclick="loadData()" style="margin-right: 40px; margin-top: 20px;">Cargar datos</button>
      </div>
   

    <!-- Elemento para simular la consola -->
    <div id="console" class="console"></div>

  </div>

  <div class="margin-button">
    <div class="flex-container" style="justify-content: center;">
      <div class="flex-item">
      <button onclick="selectDirectoryAndGeneratePDFs()" style="margin-left: 20px; margin-right: 20px;">Generar PDFs</button>
      </div>

     <div class="flex-item">
      <button onclick="generateExcel()" style="margin-right: 20px; margin-left: 20px;">Generar lista</button>
      </div>
    </div>
 </div>

  <script>
   
    let dateInputGlobal = ''; // Variable global para almacenar la fecha
  // Modifica la función loadData() para obtener la fecha del campo de entrada en index.html
function loadData() {
  const fileInput = document.getElementById('jsonFileInput');
  const file = fileInput.files[0];
  const lastNumberInput = document.getElementById('lastNumberInput').value;
  const dateInput = document.getElementById('dateInput').value; // Obtiene la fecha del campo de entrada

  if (file && lastNumberInput !== '' && dateInput !== '') {
    const reader = new FileReader();

    reader.onload = function(event) {
      const jsonContent = event.target.result;
      const data = {
        jsonContent: jsonContent,
        lastNumberInput: lastNumberInput,
        dateInput: dateInput, // Agrega la fecha al objeto de datos
      };

      dateInputGlobal = dateInput;
      // Después de definir dateInputGlobal
window.ipcRenderer.send('set-date-input-global', dateInputGlobal);
      // Envía el contenido JSON, el número de factura y la fecha al proceso principal (main.js)
      window.ipcRenderer.send('load-data', data);

      // Mostrar el resultado en la consola personalizada
      const consoleElement = document.getElementById('console');
      const message = `Número de la primer factura: ${lastNumberInput}\nFecha: ${dateInput}\nDatos del JSON: ${jsonContent}`;
      consoleElement.innerText = message;
    };

    reader.readAsText(file);
  } else {
    console.error('Error: Por favor, seleccione un archivo JSON, escriba el número de la primer factura y seleccione una fecha.');
  }
}


    // Nueva función para seleccionar directorio y generar los PDFs
    function selectDirectoryAndGeneratePDFs() {
      // Envía el evento para seleccionar el directorio antes de generar los PDFs
      window.ipcRenderer.send('select-directory')
    }

      // Nueva función para generar y guardar el Excel
      function generateExcel() {
      // Envía el evento para generar la lista Excel
      window.ipcRenderer.send('generate-excel-list')
    }

 
  </script>
</body>
</html>